define(["require","exports","tslib","react","external/lodash","modules/clean/analytics","modules/clean/auth/login/form","modules/clean/auth/login_or_register/types","modules/clean/auth/register/form","modules/clean/auth/register/types","modules/clean/auth_event_logger","modules/clean/growth/experiments/logger","modules/clean/react/comments2/data/logger","modules/clean/react/css","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/welcome_modal","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","spectrum/button","spectrum/modal","modules/clean/auth/common/stats"],(function(e,o,t,n,a,i,r,s,l,c,d,u,m,g,p,f,_,h,v,M,L,O,C,E){"use strict";var D;Object.defineProperty(o,"__esModule",{value:!0}),n=t.__importDefault(n),u=t.__importDefault(u),m=t.__importStar(m),h=t.__importStar(h);var y=((D={})[s.CommentTextVariant.DEFAULT]="default-variant",D[s.CommentTextVariant.POST]="post-comment-variant",D[s.CommentTextVariant.SUBSCRIBE]="subscribe-variant",D);o.TestOnlyCommentTextVariantCssClass=y,o.DefaultHeaderContent=function(e){var o=e.mode,t=e.onHeaderLinkClick,a=n.default.createElement(O.Button,{className:"button-as-link toggle-form-link",onClick:t,variant:"styleless"}),i=o===s.Mode.LOGIN?M._("Download and save directly to your Dropbox by signing in, or <a>create a free account</a>"):M._("Download and save to your Dropbox by creating a free account, or <a>sign in</a>");return n.default.createElement("span",null,f.reactFormat(i,{a:a}))};var b=function(e){var o,t=e.className,a=e.commentTextVariant,i=e.mode;switch(a){case s.CommentTextVariant.POST:o=i===s.Mode.LOGIN?M._("To post your comment, sign in to Dropbox."):M._("To post your comment, create a free Dropbox account.");break;case s.CommentTextVariant.SUBSCRIBE:o=i===s.Mode.LOGIN?M._("To subscribe to this file, sign in to Dropbox."):M._("To subscribe to this file, create a free Dropbox account.");break;default:o=i===s.Mode.LOGIN?M._("To continue, sign in to Dropbox."):M._("To continue, create a free Dropbox account.")}return n.default.createElement("div",{className:"text-variant "+t},o)};o.TestOnlyCommentsHeader=b;var N=function(e){var o=e.mode,t=e.onFooterLinkClick;return n.default.createElement(O.Button,{className:"button-as-link",onClick:t,variant:"styleless"},o===s.Mode.LOGIN?M._("New to Dropbox? Create a free account!"):M._("Have a Dropbox account? Sign in."))};o.DefaultFooterContent=function(e){var o=e.isDownload,t=e.onFooterLinkClick;return n.default.createElement(O.Button,{className:"button-as-link close-link",onClick:t,variant:"styleless"},o?M._("No thanks, continue to download"):M._("No thanks, continue to view"))};var T=(function(e){function g(t){var r=e.call(this,t)||this;return r.logWebActivityOnce=a.once((function(e){i.WebMiscActivityLogger.log(e,{auth_google:!0})})),r.logAuthIntent=function(){r.state.mode===s.Mode.LOGIN?d.AuthEventLogger.log_web_login_intent():d.AuthEventLogger.log_web_signup_intent()},r.renderHeader=function(){if(r.state.isThirdPartyRegistrationContinuation)return n.default.createElement("div",{className:"mc-util-modal-header center"},n.default.createElement("h1",null,M._("Create account and continue")));var e=r.props,t=e.commentParams,a=e.customHeaderContent,i=e.kind;if(a){var l=a;return n.default.createElement(l,{mode:r.state.mode,changeMode:r.toggleMode})}return n.default.createElement("div",{className:"mc-util-modal-header center"},i===s.LoginOrRegisterKind.COMMENT?n.default.createElement(b,{className:y[t.variant],commentTextVariant:t.variant,mode:r.state.mode}):n.default.createElement(o.DefaultHeaderContent,{mode:r.state.mode,onHeaderLinkClick:r.toggleMode}))},r.renderFooter=function(){var e=r.props,t=e.kind,a=e.customFooterContent,i=e.downloadAction;if(a){var l=a;return n.default.createElement(l,null)}return n.default.createElement("div",{className:"mc-util-modal-actions"},t===s.LoginOrRegisterKind.COMMENT?n.default.createElement(N,{mode:r.state.mode,onFooterLinkClick:r.toggleMode}):n.default.createElement(o.DefaultFooterContent,{isDownload:t===s.LoginOrRegisterKind.DOWNLOAD&&i===s.DownloadAction.DIRECT_DOWNLOAD,onFooterLinkClick:r.onContinueToView}))},r.toggleMode=function(e){e.preventDefault(),r.setState((function(e){if(r.props.kind===s.LoginOrRegisterKind.COMMENT){var o=e.mode===s.Mode.LOGIN?"sign_up_modal_toggle_to_sign_up":"sign_up_modal_toggle_to_sign_in";m.logEvent(o,{stream:r.props.commentParams.stream})}return{mode:e.mode===s.Mode.LOGIN?s.Mode.REGISTER:s.Mode.LOGIN}}),r.logAuthIntent)},r.onAuthenticateSuccess=function(e,o){var t=r.state.mode,a=r.props,i=a.downloadAction,l=a.kind;if(t===s.Mode.LOGIN?L.Notify.success(M._("Successfully signed in to Dropbox")):L.Notify.success(M._("Successfully signed up for Dropbox")),r.props.kind===s.LoginOrRegisterKind.COMMENT){var c=t===s.Mode.LOGIN?"sign_up_modal_sign_in_success":"sign_up_modal_sign_up_success";m.logEvent(c,{stream:r.props.commentParams.stream})}if(r.props.onAuthenticateSuccess(e),l===s.LoginOrRegisterKind.IMMEDIATE||i===s.DownloadAction.DIRECT_DOWNLOAD)if(t===s.Mode.REGISTER){if(o.force_redirect_url&&o.redirect_url)return h.redirect(o.redirect_url);u.default.log("sharing","shared_link_welcome_modal_view"),p.Modal.showInstance(n.default.createElement(_.WelcomeModal,{id:"shared-link-welcome-modal"}))}else t===s.Mode.LOGIN&&h.reload();else r.closeModal()},r.onContinueToView=function(e){e.preventDefault(),e.stopPropagation(),r.props.onContinueToView&&r.props.onContinueToView(),r.closeModal()},r.logLoginOrRegisterModalDismissed=function(){var e=r.props.kind;r.state.mode===s.Mode.REGISTER?E.AuthUXAnalyticsLogger.logSignupModalDismissed(e||void 0):E.AuthUXAnalyticsLogger.logLoginModalDismissed(e||void 0)},r.onCancel=function(e){e&&e.stopPropagation(),r.logLoginOrRegisterModalDismissed(),r.props.onCancel(),r.closeModal()},r.closeModal=function(e){e&&e.stopPropagation(),p.Modal.close(null)},r.state={mode:t.initialMode||s.Mode.LOGIN,isThirdPartyRegistrationContinuation:!1},v.assert(!(t.kind===s.LoginOrRegisterKind.COMMENT&&!t.commentParams),"Comment parameters must be provided if calling this modal from comments code"),r}return t.__extends(g,e),g.prototype.componentDidMount=function(){var e=this.props,o=e.downloadAction,t=e.kind,n=e.initialMode;this.logAuthIntent(),t===s.LoginOrRegisterKind.IMMEDIATE?this.logWebActivityOnce("signup_modal-show-upfront"):t===s.LoginOrRegisterKind.DOWNLOAD&&o===s.DownloadAction.DIRECT_DOWNLOAD&&this.logWebActivityOnce("signup_modal-show-download"),n===s.Mode.LOGIN?E.AuthUXAnalyticsLogger.logLoginModalShown(t||void 0):E.AuthUXAnalyticsLogger.logSignupModalShown(t||void 0)},g.prototype.render=function(){var e=this,o=this.state.mode,t=this.props,a=t.id,i=t.signup_tag,d=t.showGoogleRegistration;return n.default.createElement(C.Modal,{ariaLabel:"Login or register modal",appElement:document.body,bodyId:a,className:"mc-util-modal mc-util-modal-regular login-or-register-modal",displayCloseButton:!0,onRequestClose:this.onCancel,open:!0,overlayClassName:"file-viewer-modal-overlay",width:500},this.renderHeader(),n.default.createElement("div",{className:"mc-util-modal-body"},o===s.Mode.LOGIN&&n.default.createElement(r.LoginForm,{canRedirect:!1,className:"login-form-wrapper",googleLoginProps:{positionBelow:!1},showAppleLogin:this.props.showAppleLogin,appleLoginProps:{positionBelow:!1},maestroStyle:!0,onLoginSuccess:this.onAuthenticateSuccess,rememberMeCheckboxProps:{checked:!0},encryptionOptions:this.props.encryptionOptions}),o===s.Mode.REGISTER&&n.default.createElement(l.RegisterForm,{additionalParams:i?{signup_tag:i}:void 0,canRedirect:!1,className:"register-form-wrapper",maestroStyle:!0,onRegisterSuccess:this.onAuthenticateSuccess,tosCheckboxProps:{inline:!1},googleRegisterProps:d?{position:"BOTTOM"}:void 0,onRegisterFormEvent:function(o){o===c.RegisterFormEvent.GOOGLE_REGISTER_SUCCESS&&e.setState({isThirdPartyRegistrationContinuation:!0})}})),this.renderFooter())},g})(n.default.PureComponent);o.TestOnlyLoginOrRegisterModal=T;var w=g.requireCssWithComponent(T,["/static/css/components/login_or_register_modal-vflZjw7rU.css","/static/css/legacy_packages/components-vflmkI4mw.css","/static/css/components/button-vflQ0agva.css","/static/css/scooter/scooter-scoped-vflYtdnTb.css","/static/css/recaptcha_challenge-vflrcf67y.css","/static/css/recaptcha_v2_challenge-vfl5GXpO2.css"]);o.LoginOrRegisterModal=w}));
//# sourceMappingURL=modal.min.js-vfl6IoQRj.map